# Система управления банковскими картами (Bank Cards Management API)

Сервис на Spring Boot для безопасного управления банковскими картами, выполнения переводов и администрирования пользователей.

---

## Основные возможности

- **Аутентификация и авторизация** через JWT (с refresh-токенами)
- **Ролевой доступ**:
  - `ROLE_USER` — просмотр своих карт, переводы между ними, блокировка, просмотр баланса
  - `ROLE_ADMIN` — полное управление пользователями и картами
- **Переводы**:
  - Между своими картами
  - На карту другого пользователя (по 16-значному номеру)
  - Пополнение (только ADMIN)
  - Комиссия: **1%** от суммы перевода
- **Пагинация, фильтрация и сортировка** карт и транзакций
- **Валидация срока действия карты** при создании и использовании
- **Liquibase** — управление схемой БД 
- **Полная документация API** через OpenAPI 3.0 и Swagger UI

---

## Технологии

- **Java 17**, **Spring Boot 3.2.3**
- **Spring Security** + **JWT** (`io.jsonwebtoken:jjwt-api:0.11.5`)
- **Spring Data JPA**
- **PostgreSQL** (основная СУБД)
- **Liquibase** — миграции (`src/main/resources/db/changelog/`)
- **Swagger UI / OpenAPI 3.0** (`springdoc-openapi-starter-webmvc-ui:2.3.0`)
- **JUnit 5**, **MockMvc**, **H2** — покрытие ключевой бизнес-логики
- **Lombok** — упрощение DTO и сущностей

---

## Безопасность и конфиденциальность

- **Шифрование в БД**:  
  Номера карт **шифруются с использованием AES-256 в режиме GCM** (`AES/GCM/NoPadding`) перед сохранением в PostgreSQL.  
  Каждая запись содержит **уникальный IV (12 байт)**, что предотвращает атаки по шаблону.

- **Маскирование в API**:  
  Возвращаемые номера всегда в формате `**** **** **** 1234` (остаются только последние 4 цифры).  
  Поддерживается стандартная длина карт (16) и форматирование с пробелами.

- **JWT-аутентификация**:  
  Токены выдаются на **24 часа** (`86400000 мс`), используются только через заголовок `Authorization: Bearer <token>`.

- **Валидация карты**:  
  Карта считается недействительной, если:
  - Истёк срок действия (`expiryDate < now`)
  - Заблокирована (`isBlocked = true`)
  - Деактивирована (`active = false`)

- **Атомарные операции**:  
  Все переводы выполняются в рамках `@Transactional`, с проверкой баланса и начислением комиссии (1%).
